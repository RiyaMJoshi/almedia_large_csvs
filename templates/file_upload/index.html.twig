{% extends 'base.html.twig' %}

{% block title %}Manage CSVs - A|L Media{% endblock %}

{% block body %}

<div class="example-wrapper">
    {% if invalid_format != null %}
        <div class="alert alert-danger alert-dismissible d-flex align-items-center fade show" role="alert">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-exclamation-triangle-fill flex-shrink-0 me-2" viewBox="0 0 16 16" role="img" aria-label="Warning:">
                <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
            </svg>
            <div>
                {{ invalid_format }}
                <span type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></span>
            </div>
        </div>
    {% endif %}
    <h1>Manage Your Large CSVs</h1>
    {# <span class="mb-4">Make CSV files easier to operate by managing them in various ways.</span> #}
    <span class="mb-4">Reorder, Rename or Delete Your CSV Columns in an easier way.</span>
    <form action="{{path('app_upload_file')}}" method="post" class="file-top-margin" enctype="multipart/form-data" id="uploadForm">
    {# <form method="post" class="file-top-margin" enctype="multipart/form-data" id="uploadForm"> #}
        <div>
            <input class="form-control" type="file" id="formFile" name="formFile"  accept=".csv, .zip" required="required">
        </div>

        <div>
            <input class="mt-4 btn btn-primary" type="submit" id="formSubmit" value="Upload File">
            {# <input class="mt-4 btn btn-primary" type="submit" id="formSubmit" value="Upload File" onclick="submitFile()"> #}
        </div>
    </form>

    <button class="btn btn-light mx-4" id="spinner-btn" type="button" disabled>
        <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
        Please wait, Uploading...
    </button>
    {# <div class=" my-4 progress">
        <div class="bar"></div >
        <div class="percent">0%</div >
    </div> #}

    {# <div id="status"></div>  #}

</div>
{% block javascripts %}
    
<script>
$(function() {

    $('#spinner-btn').hide();
    /* $('#formSubmit').click(function(){
        $('#spinner-btn').show();
    }); */
    /* var bar = $('.bar');
    var percent = $('.percent');
    var status = $('#status');

    $('#formSubmit').click(function(e){
        var postURL = "{{path('app_upload_file')}}";
        var userFile = $("#formFile").val();
        // $('#status').html(postNama);

        $('#uploadForm').ajaxForm({
            beforeSend: function() {
                $('#spinner-btn').hide();
            },
            uploadProgress: function(event, position, total, percentComplete) {
                $('#spinner-btn').show();
            },
            complete: function(xhr) {
                $('#spinner-btn').hide();
                $.ajax({
                    type: "POST",
                    url: postURL,
                    data:
                    {
                        formFile: userFile
                    },
                    success: function(data){
                        console.log("File submitted");
                    }
                });
                e.preventDefault();
            }
        });
            // location.href = "{{path('app_upload_file')}}" // '/app_dev.php/test';
            // status.html(xhr.responseText);
        }
    );
    // });
    /*$('#uploadForm').ajaxForm({
        beforeSend: function() {
             $('#spinner-btn').hide();
        },
        uploadProgress: function(event, position, total, percentComplete) {
            $('#spinner-btn').show();
        },
        complete: function(xhr) {
            $('#spinner-btn').hide();
            location.href = "{{path('app_upload_file')}}" // '/app_dev.php/test';
            // status.html(xhr.responseText);
        }
    }); */
});  
/*
function submitFile() {
    // console.log('{{ region }}');
    
    // Create service client module using ES6 syntax.
    import { S3Client } from "@aws-sdk/client-s3";
    // Set the AWS Region.
    const REGION = '{{ region }}'; //e.g. "us-east-1"
    // Create an Amazon S3 service client object.
    const s3Client = new S3Client({ region: REGION });
    export { s3Client };
    console.log("S3Client created..");

}
*/
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script> 
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.min.js" type="text/javascript"></script> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/4.3.0/jquery.form.min.js" integrity="sha384-qlmct0AOBiA2VPZkMY3+2WqkHtIQ9lSdAsAn5RUJD/3vA5MKDgSGcdmIv4ycVxyn" crossorigin="anonymous"></script>
{# <script> $(document).ready(function(){ console.log("From doc console"); }); </script> #}
{% endblock %}
{% endblock %}
